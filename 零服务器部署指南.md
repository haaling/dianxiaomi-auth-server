# ğŸš€ é›¶æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—ï¼ˆå®Œå…¨å…è´¹ï¼‰

ä½ ä¸éœ€è¦è´­ä¹°æœåŠ¡å™¨ï¼ä½¿ç”¨ä»¥ä¸‹å…è´¹æœåŠ¡å³å¯å®Œæˆéƒ¨ç½²ã€‚

## ğŸ“¦ æ–¹æ¡ˆæ€»è§ˆ

1. **ä»£ç æ‰˜ç®¡**ï¼šGitHub âœ… (å·²å®Œæˆ)
2. **æ•°æ®åº“**ï¼šMongoDB Atlas (å…è´¹ 512MB)
3. **æœåŠ¡å™¨**ï¼šRailway (å…è´¹é¢åº¦ $5/æœˆ)

æ€»æˆæœ¬ï¼š**Â¥0** (å…è´¹é¢åº¦è¶³å¤Ÿå°è§„æ¨¡ä½¿ç”¨)

---

## ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå…è´¹æ•°æ®åº“ (5åˆ†é’Ÿ)

### MongoDB Atlas æ³¨å†Œ

1. è®¿é—®ï¼šhttps://www.mongodb.com/cloud/atlas/register
2. ä½¿ç”¨ Google/GitHub è´¦å·å¿«é€Ÿæ³¨å†Œ
3. åˆ›å»ºç»„ç»‡å’Œé¡¹ç›®ï¼ˆéšä¾¿å‘½åï¼‰

### åˆ›å»ºå…è´¹é›†ç¾¤

1. ç‚¹å‡» "Build a Database"
2. é€‰æ‹© **"M0 FREE"** é€‰é¡¹ï¼ˆæ°¸ä¹…å…è´¹ï¼‰
3. é€‰æ‹©äº‘æœåŠ¡å•†ï¼š**AWS** 
4. é€‰æ‹©åœ°åŒºï¼š**é¦™æ¸¯ (ap-east-1)** æˆ– **æ–°åŠ å¡ (ap-southeast-1)**
5. é›†ç¾¤åç§°ï¼š`dianxiaomi-cluster`
6. ç‚¹å‡» "Create"

### é…ç½®è®¿é—®æƒé™

**å®‰å…¨è®¾ç½® â†’ Network Accessï¼š**
1. ç‚¹å‡» "Add IP Address"
2. é€‰æ‹© "Allow Access from Anywhere"
3. ç¡®è®¤ï¼ˆè¿™æ · Railway æœåŠ¡å™¨å¯ä»¥è®¿é—®ï¼‰

**å®‰å…¨è®¾ç½® â†’ Database Accessï¼š**
1. ç‚¹å‡» "Add New Database User"
2. è®¤è¯æ–¹å¼ï¼šPassword
3. ç”¨æˆ·åï¼š`dianxiaomi`
4. å¯†ç ï¼šç‚¹å‡»"Autogenerate Secure Password"ï¼ˆè®°ä¸‹è¿™ä¸ªå¯†ç ï¼ï¼‰
5. æƒé™ï¼š`Atlas admin`
6. ç‚¹å‡» "Add User"

### è·å–è¿æ¥å­—ç¬¦ä¸²

1. å›åˆ° Database é¡µé¢
2. ç‚¹å‡» "Connect"
3. é€‰æ‹© "Connect your application"
4. å¤åˆ¶è¿æ¥å­—ç¬¦ä¸²ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
mongodb+srv://dianxiaomi:<password>@dianxiaomi-cluster.xxxxx.mongodb.net/?retryWrites=true&w=majority
```

5. å°† `<password>` æ›¿æ¢ä¸ºåˆšæ‰è‡ªåŠ¨ç”Ÿæˆçš„å¯†ç 
6. åœ¨æœ«å°¾ `?` å‰åŠ ä¸Šæ•°æ®åº“åï¼š

```
mongodb+srv://dianxiaomi:ä½ çš„å¯†ç @dianxiaomi-cluster.xxxxx.mongodb.net/dianxiaomi_auth?retryWrites=true&w=majority
```

**ä¿å­˜è¿™ä¸ªè¿æ¥å­—ç¬¦ä¸²ï¼**

---

## ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²åˆ° Railway (5åˆ†é’Ÿ)

### æ³¨å†Œ Railway

1. è®¿é—®ï¼šhttps://railway.app/
2. ç‚¹å‡» "Login" â†’ ç”¨ **GitHub** ç™»å½•ï¼ˆè‡ªåŠ¨å…³è”ä½ çš„ä»“åº“ï¼‰
3. éªŒè¯é‚®ç®±

### éƒ¨ç½²é¡¹ç›®

1. ç‚¹å‡» "New Project"
2. é€‰æ‹© "Deploy from GitHub repo"
3. æ‰¾åˆ°å¹¶é€‰æ‹© **`dianxiaomi-auth-server`**
4. Railway ä¼šè‡ªåŠ¨æ£€æµ‹åˆ° Node.js é¡¹ç›®å¹¶å¼€å§‹éƒ¨ç½²
5. ç­‰å¾…åˆæ¬¡éƒ¨ç½²å®Œæˆï¼ˆçº¦2-3åˆ†é’Ÿï¼‰

### é…ç½®ç¯å¢ƒå˜é‡

1. åœ¨é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡»ä½ çš„æœåŠ¡
2. åˆ‡æ¢åˆ° "Variables" æ ‡ç­¾
3. ç‚¹å‡» "New Variable"ï¼Œæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

**å¿…å¡«å˜é‡ï¼š**

| å˜é‡å | å€¼ |
|--------|-----|
| `NODE_ENV` | `production` |
| `PORT` | `3000` |
| `MONGODB_URI` | `<ä½ åˆšæ‰ä¿å­˜çš„MongoDBè¿æ¥å­—ç¬¦ä¸²>` |
| `JWT_SECRET` | `<è¿è¡Œä¸‹é¢å‘½ä»¤ç”Ÿæˆ>` |
| `ALLOWED_ORIGINS` | `chrome-extension://*` |

**ç”Ÿæˆ JWT_SECRETï¼ˆåœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œï¼‰ï¼š**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

å¤åˆ¶è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼Œç²˜è´´åˆ° `JWT_SECRET` çš„å€¼ä¸­ã€‚

### é‡æ–°éƒ¨ç½²

1. é…ç½®å®Œç¯å¢ƒå˜é‡åï¼Œç‚¹å‡» "Deploy" â†’ "Redeploy"
2. ç­‰å¾…éƒ¨ç½²å®Œæˆ

### è·å–éƒ¨ç½²åœ°å€

1. åœ¨ "Settings" æ ‡ç­¾ä¸­
2. æ‰¾åˆ° "Domains" éƒ¨åˆ†
3. ç‚¹å‡» "Generate Domain"
4. Railway ä¼šç”Ÿæˆä¸€ä¸ªåŸŸåï¼Œä¾‹å¦‚ï¼š
   ```
   https://dianxiaomi-auth-server-production-xxxx.up.railway.app
   ```

**ä¿å­˜è¿™ä¸ªåœ°å€ï¼**è¿™å°±æ˜¯ä½ çš„æœåŠ¡å™¨åœ°å€ã€‚

### æµ‹è¯•æœåŠ¡å™¨

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
https://ä½ çš„Railwayåœ°å€.up.railway.app/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "success": true,
  "message": "æœåŠ¡å™¨è¿è¡Œæ­£å¸¸",
  "timestamp": "..."
}
```

---

## ç¬¬ä¸‰æ­¥ï¼šæ›´æ–° Chrome æ’ä»¶é…ç½® (1åˆ†é’Ÿ)

ç¼–è¾‘æ–‡ä»¶ï¼š`/Users/bilibili/dxm/dianxiaomi/utils/auth-config.js`

æ‰¾åˆ°è¿™ä¸€è¡Œï¼š
```javascript
API_BASE_URL: 'http://localhost:3000/api',
```

æ”¹ä¸ºï¼š
```javascript
API_BASE_URL: 'https://ä½ çš„Railwayåœ°å€.up.railway.app/api',
```

**ç¤ºä¾‹ï¼š**
```javascript
const AuthConfig = {
  SERVER: {
    API_BASE_URL: 'https://dianxiaomi-auth-server-production-xxxx.up.railway.app/api',
    // ...
  },
  // ...
};
```

ä¿å­˜æ–‡ä»¶ï¼Œç„¶ååœ¨ Chrome æ‰©å±•é¡µé¢åˆ·æ–°æ’ä»¶ã€‚

---

## ç¬¬å››æ­¥ï¼šåˆ›å»ºå®¢æˆ·è´¦å· (2åˆ†é’Ÿ)

### æ–¹å¼ä¸€ï¼šé€šè¿‡ Railway Shellï¼ˆæ¨èï¼‰

1. åœ¨ Railway é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡»ä½ çš„æœåŠ¡
2. åˆ‡æ¢åˆ° "Shell" æ ‡ç­¾
3. è¿è¡Œå‘½ä»¤ï¼š
   ```bash
   npm run create-customer
   ```

### æ–¹å¼äºŒï¼šæœ¬åœ°è¿æ¥è¿œç¨‹æ•°æ®åº“

1. åœ¨æœ¬åœ°åˆ›å»º `.env` æ–‡ä»¶ï¼š
   ```bash
   cd /Users/bilibili/dxm/dianxiaomi-auth-server
   cp .env.example .env
   ```

2. ç¼–è¾‘ `.env`ï¼Œå°† `MONGODB_URI` æ”¹ä¸ºä½ çš„ MongoDB Atlas è¿æ¥å­—ç¬¦ä¸²

3. è¿è¡Œï¼š
   ```bash
   npm run create-customer
   ```

4. æŒ‰æç¤ºè¾“å…¥å®¢æˆ·ä¿¡æ¯

---

## ç¬¬äº”æ­¥ï¼šæµ‹è¯•å®Œæ•´æµç¨‹ (2åˆ†é’Ÿ)

1. æ‰“å¼€ Chrome æ’ä»¶
2. ä½¿ç”¨åˆšåˆ›å»ºçš„è´¦å·ç™»å½•
3. æ£€æŸ¥æ˜¯å¦æˆåŠŸï¼

---

## ğŸ’° è´¹ç”¨è¯´æ˜

### MongoDB Atlas
- å…è´¹é¢åº¦ï¼š512MB å­˜å‚¨
- è¶³å¤Ÿå­˜å‚¨çº¦ 5000+ ç”¨æˆ·è´¦å·
- **æ°¸ä¹…å…è´¹**

### Railway
- å…è´¹é¢åº¦ï¼šæ¯æœˆ $5 ä½¿ç”¨é¢åº¦
- çº¦ç­‰äºï¼š500å°æ—¶è¿è¡Œæ—¶é—´
- å¯¹äºå°è§„æ¨¡åº”ç”¨ï¼ˆ100-500 ç”¨æˆ·ï¼‰å®Œå…¨å…è´¹
- è¶…å‡ºåå¯å‡çº§åˆ° $5/æœˆä»˜è´¹è®¡åˆ’

### æ€»ç»“
**å‰æœŸå®Œå…¨å…è´¹ï¼Œç”¨æˆ·å¢é•¿åæ¯æœˆæœ€å¤š $5 (çº¦Â¥35)**

---

## ğŸ”„ æ—¥å¸¸ç®¡ç†

### æŸ¥çœ‹æ‰€æœ‰å®¢æˆ·è´¦å·
Railway Shell ä¸­è¿è¡Œï¼š
```bash
npm run list-accounts
```

### åˆ›å»ºæ–°å®¢æˆ·
Railway Shell ä¸­è¿è¡Œï¼š
```bash
npm run create-customer
```

### æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
åœ¨ Railway é¡¹ç›®é¡µé¢çš„ "Logs" æ ‡ç­¾æŸ¥çœ‹

---

## â“ å¸¸è§é—®é¢˜

**Q: Railway å…è´¹é¢åº¦ç”¨å®Œæ€ä¹ˆåŠï¼Ÿ**  
A: å¯ä»¥å‡çº§åˆ° $5/æœˆçš„ä»˜è´¹è®¡åˆ’ï¼Œæˆ–è¿ç§»åˆ°å…¶ä»–å…è´¹å¹³å°ï¼ˆRenderã€Fly.ioï¼‰

**Q: å¦‚ä½•æ›´æ–°æœåŠ¡å™¨ä»£ç ï¼Ÿ**  
A: ç›´æ¥ `git push` åˆ° GitHubï¼ŒRailway ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²

**Q: å¿˜è®° MongoDB å¯†ç æ€ä¹ˆåŠï¼Ÿ**  
A: åœ¨ MongoDB Atlas çš„ Database Access é¡µé¢é‡ç½®å¯†ç 

**Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**  
A: MongoDB Atlas æ¯å¤©è‡ªåŠ¨å¤‡ä»½ï¼Œä¿ç•™ 2 å¤©

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] MongoDB Atlas é›†ç¾¤åˆ›å»ºæˆåŠŸ
- [ ] è·å–äº† MongoDB è¿æ¥å­—ç¬¦ä¸²
- [ ] Railway é¡¹ç›®éƒ¨ç½²æˆåŠŸ
- [ ] é…ç½®äº†æ‰€æœ‰ç¯å¢ƒå˜é‡
- [ ] è·å–äº† Railway éƒ¨ç½²åœ°å€
- [ ] æ›´æ–°äº† Chrome æ’ä»¶é…ç½®
- [ ] åˆ›å»ºäº†æµ‹è¯•å®¢æˆ·è´¦å·
- [ ] åœ¨æ’ä»¶ä¸­æˆåŠŸç™»å½•

å…¨éƒ¨å®Œæˆåï¼Œä½ å°±å¯ä»¥å¼€å§‹å”®å–äº†ï¼ğŸ‰

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š
- `DEPLOYMENT.md` - å®Œæ•´éƒ¨ç½²æ–‡æ¡£
- `README.md` - é¡¹ç›®è¯´æ˜
- Railway å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.railway.app/

ç¥ä½ ç”Ÿæ„å…´éš†ï¼ğŸ’°
